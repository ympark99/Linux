## 리눅스시스템프로그래밍 설계 1 (ssu_sindex)

- ssu_sindex는 지정한 파일 또는 디렉토리의 이름을 탐색해서 파일 및 디렉토리의 속성을 비교하는 프로그램

### ssu_sindex 프로그램 기본 사항
- ssu_sindex는 주어진 디렉토리 내 특정 파일(이하 정규 파일과 디렉토리 파일 모두 가능)과 이름 및 크기가 동일한 정규 파 일(이하 정규 파일과 디렉토리 파일 모두 가능)을 찾고 비교하는 프로그램
- ssu_sindex에 내장된 find 명령어의 첫 번째 인자는 찾고자 하는 파일이며, ssu_sindex에 내장된 find 명령어의 두 번째 인자는 탐색을 시작할 디렉토리 경로
- ssu_sindex에 내장된 find 명령어를 통해 두 번째 인자부터 두 번째 인자의 전체 서브디렉토리까지 재귀적으로 첫 번째 인 자를 탐색하여 첫 번째 인자의 이름과 크기 모두 동일한 파일을 찾아 해당 파일의 속성을 출력
- ssu_sindex에서 동일한 이름과 크기의 파일이 존재할 경우, 특정 파일의 인덱스(index) 번호를 입력하면 선택된 파일의 속 성 및 내용을 비교(diff)


### 설계 및 구현
- 가) 프롬프트 출력
  - 프롬프트 모양 : “학번>” 문자 출력 (ex) 20201234>)
  - 프롬프트에서는 ssu_sindex 내장 명령어인 find, exit, help 명령어만 실행
  - 이외 명령어 실행 시 자동으로 help를 실행시킨 것과 동일한 결과가 출력되어야 함
  - 엔터 키만 입력 시 프롬프트 재출력
- 나) 내장명령어 1, find [FILENAME] [PATH]
  -파일(디렉토리)이름과 디렉토리 경로 입력 시 입력한 디렉토리부터 탐색을 시작하여 이름과 크기가 동일한 모든 파일(디렉토리)을 리스트로 출력
  -파일 리스트에서 특정 파일(디렉토리)을 선택하면 해당 파일(디렉토리)과 입력한 파일(디렉토리) 내용의 차이점을 출력
  - [FILENAME]
    - 현재 또는 특정 디렉토리 내에 존재하는 파일(디렉토리) 이름(절대경로와 상대경로 모두 가능해야 함)
    - FILENAME 입력이 없거나 존재하지 않는 파일(디렉토리)일 경우, 에러 처리 후 프롬프트 출력
  - [PATH]
    - 탐색을 시작할 디렉토리 경로(절대경로와 상대경로 모두 가능해야 함)
    - [PATH] 인자에 루트(“/”)를 입력할 경우, 파일 탐색 시 권한 문제가 발생할 수 있으므로 root 권한으로 실행해야 함 - [PATH] 인자에 입력이 없거나 존재하지 않는 파일인 경우, 에러 처리 후 프롬프트 출력
  - find 명령어 실행 시 출력은 다음과 같음
  - 첫째 줄에는 파일 리스트의 순번과 파일 정보를 다음과 같은 순서대로 행에 출력
    - index(탐색한 파일의 순번), Size(파일 크기), Mode(10bit, 파일 종류 및 접근 권한), Blocks(할당된 블록 수), Links(하드링크 수), UID(사용자 ID), GID(그룹 ID), Access(최종 접근 시간), Change(최종 상태 변경 시간), Modify(최종 수정 시간), Path(파일의 절대 경로)
  - 둘째 줄에는 입력한 [FILENAME]의 정보(index, Size, Mode, Blocks, Links, UID, GID, Access, Change, Modify, Path) 출력, 단 index는 0으로 출력
  - 셋째 줄부터는 입력한 [FILENAME]과 동일한(이름과 크기가 동일한 파일 탐색 결과) 파일의 정보 (index, Size, Mode, Blocks, Links, UID, GID, Access, Change, Modify, Path) 출력. 단, 디렉토리 간 탐색은 제약은 없음 (Depth First나 Breadth First 중 하나 구현하면 됨)
    - 파일 리스트는 파일의 절대 경로가 아스키 코드 소팅 순서에 맞게 출력
  - 파일 리스트 출력 후 “>>” 문자 출력하여 사용자의 입력을 대기
  - 탐색 결과 이름과 크기가 같은 파일이 없을 경우 “(None)” 출력 후 프롬프트 출력

    <img width="523" alt="image" src="https://user-images.githubusercontent.com/43109589/159857581-2492756c-8f54-49ea-b6f7-46521ea94a7b.png">
    
  - [INDEX] [OPTION ... ] - [INDEX]
    - 파일 리스트에서 비교하고자 하는 파일의 순번(인덱스 번호)
    - INDEX 입력이 없거나 존재하지 않을 경우, 에러 처리 후 다시 입력 대기
  - 사용자가 선택한 [INDEX]에 해당하는 정규 파일과 index가 0인 정규 파일(즉, find 명령어의 첫 번째 인자 [FILENAME]에 해당하는 파일)의 내용을 비교하여 차이점 출력
    1. 사용자가 선택한 [INDEX]에 해당하는 파일과 index가 0인 파일의 내용이 차이가 없을 경우 아무 것도 출력하지 않음
    2. 사용자가 선택한 [INDEX]에 해당하는 파일과 index가 0인 파일의 내용이 차이가 있을 경우 차이점을 출력
    3. 정규 파일 비교 시 차이점 출력 방법
      - 정규 파일은 1023개 이하의 문자를 포함하는 파일만 가능
      - 두 파일을 라인 단위로 비교하여 차이점을 출력
      - 파일 끝에 개행이 없을 경우 “\No newline at end of file” 출력

      <img width="504" alt="image" src="https://user-images.githubusercontent.com/43109589/159858008-f416fef9-e604-461a-a0ff-adbb5c238e4c.png">

  - [INDEX] [OPTION ... ]
  - 사용자가 선택한 [INDEX]에 해당하는 디렉토리 파일과 index가 0인 디렉토리 (즉, find 명령의 첫 번째 [FILENAME]에 해당하는 디렉토리 파일)의 내용을 비교하여 차이점 출력
    - 두 디렉토리의 하위 파일 또는 하위 디렉토리의 이름을 비교하여 차이점을 출력 $두 디렉토리의 하위 정규 파일들 중 이름이 동일하나,
      - (1) 내용이 다른 경우 “diff [현재 적용된 OPTION] [(비교할 기준) 입력 하위 파일 경로] [(찾고자 하는) 대상 하위 파일 경로]” 출력 후 차이점 출력
      - (2) 파일 종류가 다른 경우 “File [(비교할 기준) 입력 하위 파일 경로] is a [directory/regular file] while file [(찾고자 하는)대상 하위 파일 경로] is a [directory/regular file]” 출력
    - 두 디렉토리의 하위 디렉토리 이름이 동일한 경우 “Common subdirectories : [(비교할 기준) 입력 하위 디렉토리 경로] and [(찾고자 하는)대상 하위 디렉토리 경로]” 출력
    - 단, [INDEX] [OPTION ... ]에서 [OPTION ... ]에 -r이 없을 경우 재귀적으로 하위 디렉토리 모두 비교하지 않고 해당 디렉토리 내 정규 파일과 디렉토리 파일의 단순 이름 비교만 수행
    - 단, [INDEX] [OPTION ... ]에서 [OPTION ... ]에 -r이 있을 경우 재귀적으로 하위 디렉토리 내 전체 정규 파일과 디렉토리 파일 비교 수행
  - 정규 파일의 이름 또는 디렉토리 이름이 다른 것은 “Only in [디렉토리명]: [파일명]” 출력 " 정규 파일의 이름 또는 디렉토리 이름 비교는 아스키코드 순으로 진행하고 결과 출력
  - 비교를 마치면 프롬프트 출력

- [OPTION]
  - OPTION은 공백으로 구분하여 입력하며 다음 4개의 OPTION은 동시에 사용 가능 (예. q s i r 띄어서 옵션 사용,순서 상관 없음)
  - OPTION이 존재하지 않을 경우나 공백 없이 여러 OPTION이 동시에 사용된 경우, 에러 처리 후 다시 입력 대기
    - q : 두 파일 내용이 다른 경우 차이점 출력 없이 알림
      - “Files [입력 하위 파일 경로] and [대상 하위 파일 경로] differ” 출력
    - s : 두 파일 내용이 동일한 경우 알림
      - “Files [입력 하위 파일 경로] and [대상 하위 파일 경로] are identical” 출력
    - i : 대소문자 구분 없이 비교
    - r : 디렉토리 비교 시 하위 디렉토리를 전부 재귀적으로 탐색하여 모든 파일 비교

      <img width="506" alt="image" src="https://user-images.githubusercontent.com/43109589/159858724-42c54dfd-e96d-4cee-afcf-8c77f3e2b898.png">

  - 다) 내장명령어 2, exit
    - 프로그램을 종료시키는 명령어
    - exit 명령어 실행 시 프로그램 실행 시간(gettimeofday() 사용) 출력 후 종료
    - exit 명령어 실행 시 명령어를 실행시키는 프로세스, ssu_sindex 프로세스 모두가 종료되어야 함

  - 라) 내장명령어 3, help
    - 명령어 사용법을 출력하는 명령어
